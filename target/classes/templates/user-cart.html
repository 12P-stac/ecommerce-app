<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Dashboard - Ecommerce App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">ðŸ›’ Ecommerce Admin</a>
        <a class="nav-link text-light ms-auto" th:href="@{/logout}">Logout</a>
    </div>
</nav>

<div class="container mt-5">
    <h2 class="text-center mb-4">Admin Dashboard</h2>

    <!-- Users Section -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">All Registered Users</div>
        <div class="card-body">

            <!-- User Search -->
            <form method="get" th:action="@{/admin/dashboard}" class="mb-3 d-flex">
                <input type="text" name="userSearch" class="form-control me-2" placeholder="Search users"
                       th:value="${userSearch}">
                <button class="btn btn-light" type="submit">Search</button>
            </form>

            <!-- Users Table -->
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="user : ${usersPage.content}">
                        <td th:text="${user.id}"></td>
                        <td th:text="${user.username}"></td>
                        <td th:text="${user.email}"></td>
                        <td th:text="${user.role}"></td>
                        <td>
                            <a th:href="@{'/admin/users/' + ${user.id} + '/products'}" class="btn btn-sm btn-info">Products</a>
                            <a th:href="@{'/admin/users/' + ${user.id} + '/cart'}" class="btn btn-sm btn-warning">Cart</a>
                            <a th:href="@{'/admin/users/' + ${user.id} + '/dashboard'}" class="btn btn-sm btn-success">Dashboard</a>
                            <a th:href="@{'/admin/users/delete/' + ${user.id}}" class="btn btn-sm btn-danger"
                               onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Users Pagination -->
            <nav>
                <ul class="pagination">
                    <li class="page-item" th:classappend="${usersPage.first}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/admin/dashboard(userPage=${usersPage.number-1}, productPage=${productsPage.number}, userSearch=${userSearch}, productSearch=${productSearch})}">Previous</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, usersPage.totalPages-1)}"
                        th:classappend="${usersPage.number == i}? 'active'">
                        <a class="page-link"
                           th:href="@{/admin/dashboard(userPage=${i}, productPage=${productsPage.number}, userSearch=${userSearch}, productSearch=${productSearch})}"
                           th:text="${i+1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${usersPage.last}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/admin/dashboard(userPage=${usersPage.number+1}, productPage=${productsPage.number}, userSearch=${userSearch}, productSearch=${productSearch})}">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Products Section -->
    <div class="card">
        <div class="card-header bg-success text-white">All Products</div>
        <div class="card-body">

            <!-- Product Search -->
            <form method="get" th:action="@{/admin/dashboard}" class="mb-3 d-flex">
                <input type="text" name="productSearch" class="form-control me-2" placeholder="Search products"
                       th:value="${productSearch}">
                <button class="btn btn-light" type="submit">Search</button>
            </form>

            <!-- Products Table -->
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Available</th>
                        <th>Seller</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${productsPage.content}">
                        <td th:text="${product.id}"></td>
                        <td th:text="${product.name}"></td>
                        <td th:text="${product.price}"></td>
                        <td th:text="${product.quantity}"></td>
                        <td th:text="${product.available}"></td>
                        <td th:text="${product.user.username}"></td>
                        <td>
                            <a th:href="@{'/admin/users/' + ${product.user.id} + '/cart'}" class="btn btn-sm btn-warning">User Cart</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Products Pagination -->
            <nav>
                <ul class="pagination">
                    <li class="page-item" th:classappend="${productsPage.first}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/admin/dashboard(productPage=${productsPage.number-1}, userPage=${usersPage.number}, userSearch=${userSearch}, productSearch=${productSearch})}">Previous</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, productsPage.totalPages-1)}"
                        th:classappend="${productsPage.number == i}? 'active'">
                        <a class="page-link"
                           th:href="@{/admin/dashboard(productPage=${i}, userPage=${usersPage.number}, userSearch=${userSearch}, productSearch=${productSearch})}"
                           th:text="${i+1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${productsPage.last}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/admin/dashboard(productPage=${productsPage.number+1}, userPage=${usersPage.number}, userSearch=${userSearch}, productSearch=${productSearch})}">Next</a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>

</div>
</body>
</html>
